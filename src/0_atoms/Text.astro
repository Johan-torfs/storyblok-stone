---
import { storyblokEditable, type SbBlokData, type ISbRichtext, renderRichText } from '@storyblok/astro';
import TextSvelte from './text/Text.svelte';
import { getClassName, getFontClasses, getFontSizeClasses, getMarginBottomClasses, getTextCenterClasses, getTextColorClasses, getTextWidthClasses, getTextDecorationClasses, getTextUppercaseClasses } from '../tailwind/class_name_compiler';
import type { TextColor } from '../tailwind/types/Color';
import type { MarginBottom } from '../tailwind/types/Margin';
import type { TextFont, TextSize, TextCenter, TextWidth, TextDecoration, TextUpperCase } from '../tailwind/types/Text';

interface StoryblokParagraph extends SbBlokData, TextColor, TextFont, TextSize, TextCenter, TextWidth, TextDecoration, TextUpperCase, MarginBottom {
    component: 'paragraph';
    content: ISbRichtext;
    interactive?: boolean;
}


interface Props {
    blok: StoryblokParagraph;
}

const { blok } = Astro.props;

const className = getClassName(blok, {
    decorators: [
        {decorator: getTextColorClasses},
        {decorator: getFontClasses},
        {decorator: getFontSizeClasses},
        {decorator: getTextCenterClasses},
        {decorator: getMarginBottomClasses},
        {decorator: getTextWidthClasses},
        {decorator: getTextDecorationClasses},
        {decorator: getTextUppercaseClasses}
    ]
});
 
const html = renderRichText(blok.content);
const storyblokEditableData = storyblokEditable(blok);
const htmlWithClass = html.replace(/<p>/g, `<p class="${className}" data-blok-c='${storyblokEditableData['data-blok-c']}' data-blok-uid='${storyblokEditableData['data-blok-uid']}' interactive='${!!blok.interactive}'>`)
---

{blok.interactive ? <TextSvelte htmlWithClass={htmlWithClass} client:visible/> : <Fragment set:html={htmlWithClass} class=" max"/>} 
